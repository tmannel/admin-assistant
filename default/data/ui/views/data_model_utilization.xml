<form stylesheet="admin_assistant_stylesheet.css" theme="light">
  <label>Data Model Utilization</label>
  <description>Understand your use of data models.</description>
  <search id="dataModel_rest_baseSearch">
    <!-- Base Search 1 -->
    <query>
      | rest /servicesNS/-/-/datamodel/model
      | rename eai:acl.* as *
      | spath input=acceleration output=acceleration_enabled path=enabled 
      | spath input=description output=fields objects{}.fields{}.fieldName
      | spath input=description output=tags objects{}.comment{}.tags{}
      | search $displayName_token$ $app_token$
    </query>
    <earliest>-1d</earliest>
    <latest>now</latest>
  </search>
  <fieldset submitButton="true" autoRun="true">
    <input type="multiselect" token="splunk_server_token">
      <label>splunk_server</label>
      <prefix>splunk_server IN (</prefix>
      <suffix>)</suffix>
      <delimiter>, </delimiter>
      <fieldForLabel>splunk_server</fieldForLabel>
      <fieldForValue>splunk_server</fieldForValue>
      <search>
        <query>
          | rest servicesNS/-/-/server/info
          | dedup splunk_server
          | fields splunk_server
        </query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="*">All</choice>
      <initialValue>*</initialValue>
    </input>
    <input type="multiselect" token="displayName_token">
      <label>Data Model</label>
      <choice value="*">All</choice>
      <initialValue>*</initialValue>
      <delimiter> OR  </delimiter>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>displayName="</valuePrefix>
      <fieldForLabel>displayName</fieldForLabel>
      <fieldForValue>displayName</fieldForValue>
      <search>
        <query>| rest /servicesNS/-/-/datamodel/model</query>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </search>
      <valueSuffix>"</valueSuffix>
    </input>
    <input type="multiselect" token="app_token">
      <label>App</label>
      <choice value="*">All</choice>
      <initialValue>*</initialValue>
      <fieldForLabel>eai:acl.app</fieldForLabel>
      <fieldForValue>eai:acl.app</fieldForValue>
      <search>
        <query>
          | rest /servicesNS/-/-/datamodel/model
          | fields eai:acl.app
          | dedup eai:acl.app
        </query>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </search>
      <delimiter> OR  </delimiter>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>app=</valuePrefix>
    </input>
  </fieldset>
  <row>
    <panel id="html_header1">
      <html encoded="1">&lt;h1 align="center"&gt;Data Models Overview&lt;/h1&gt;
            </html>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Distinct Counts</title>
        <search base="dataModel_rest_baseSearch">
          <query>| stats dc(title) as "distinct data models", dc(app) as "distinct apps", dc(tags) as "distinct tags", dc(splunk_server) as "distinct splunk servers"
| transpose column_name="property"
| rename "row 1" as value</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <viz type="sankey_diagram_app.sankey_diagram">
        <title>Distinct data models by app, splunk_server</title>
        <search base="dataModel_rest_baseSearch">
          <query>| stats count by splunk_server app title
| appendpipe 
    [stats count by splunk_server app
    | rename splunk_server as origin, app as target]
| appendpipe 
    [stats count by app title
    | rename app as origin, title as target]
| search origin=*
| fields origin target count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </viz>
    </panel>
    <panel>
      <chart>
        <title>Distinct data models by App, Acceleration</title>
        <search base="dataModel_rest_baseSearch">
          <query>| chart dc(title) over app by acceleration_enabled
| addtotals fieldname=temp_field
| sort - temp_field
| fields - temp_field
| rename false as "not accelerated", true as "accelerated"</query>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Data Model Details</title>
      <table>
        <search base="dataModel_rest_baseSearch">
          <query>| rename eai:acl.* as * 
| streamstats values(tags) as tags by splunk_server app title 
| table splunk_server app title displayName tags acceleration_enabled disabled perms.* author 
| rename eai:acl.* as * 
| sort disabled - acceleration_enabled splunk_server app
| mvcombine splunk_server</query>
        </search>
        <option name="count">25</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <format type="color" field="acceleration.allowed">
          <colorPalette type="map">{"0":#53A051,"1":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="eai:acl.app">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="app">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="dc_datamodel_constraints">
          <colorPalette type="minMidMax" maxColor="#5A4575" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax" minValue="1"></scale>
        </format>
        <format type="color" field="dc_fields">
          <colorPalette type="minMidMax" maxColor="#5A4575" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax" minValue="1"></scale>
        </format>
        <format type="color" field="dc_output_fields">
          <colorPalette type="minMidMax" maxColor="#5A4575" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax" minValue="1"></scale>
        </format>
        <format type="color" field="splunk_server">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
</form>
